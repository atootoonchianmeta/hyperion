<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-packages/hyperion-core/FunctionInterceptor" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.1">
<title data-rh="true">Function Interceptor | Hyperion</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.hyperionjs.com/docs/packages/hyperion-core/FunctionInterceptor"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Function Interceptor | Hyperion"><meta data-rh="true" name="description" content="FunctionInterceptor is at the heart of hyperion-core and creates"><meta data-rh="true" property="og:description" content="FunctionInterceptor is at the heart of hyperion-core and creates"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.hyperionjs.com/docs/packages/hyperion-core/FunctionInterceptor"><link data-rh="true" rel="alternate" href="https://www.hyperionjs.com/docs/packages/hyperion-core/FunctionInterceptor" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.hyperionjs.com/docs/packages/hyperion-core/FunctionInterceptor" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hyperion RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hyperion Atom Feed"><link rel="stylesheet" href="/assets/css/styles.ae260252.css">
<script src="/assets/js/runtime~main.6e8e58e8.js" defer="defer"></script>
<script src="/assets/js/main.fb037e95.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/hyperion.svg" alt="Hyperion Logo" class="themedComponent_DHUr themedComponent--light_DIHH"><img src="/img/hyperion.svg" alt="Hyperion Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M"></div><b class="navbar__title text--truncate">Hyperion</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/hyperion" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_bmvg"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV"><div class="docsWrapper_XLvK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docRoot_HciC"><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class="sidebarViewport_N8x0"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Hyperion Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/hyperion-packages">Hyperion Packages</a><button aria-label="Collapse sidebar category &#x27;Hyperion Packages&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-hook">hyperion-hook</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/hyperion-core">hyperion-core</a><button aria-label="Collapse sidebar category &#x27;hyperion-core&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-core/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/packages/hyperion-core/FunctionInterceptor">Function Interceptor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-core/BuiltInInterceptors">Builtin JS interceptors</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-dom">hyperion-dom</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-flowlet">hyperion-flowlet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-channel">hyperion-channel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-react">hyperion-react</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-autologging">hyperion-autologging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-async-counter">hyperion-async-counter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-autologging-visualizer">hyperion-autologging-visualizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-devtools">hyperion-devtools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-docs">hyperion-docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-global">hyperion-global</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-react-testapp">hyperion-react-testapp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-test-and-set">hyperion-test-and-set</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-timed-trigger">hyperion-timed-trigger</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/packages/hyperion-util">hyperion-util</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_namt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/hyperion-packages"><span itemprop="name">Hyperion Packages</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/hyperion-core"><span itemprop="name">hyperion-core</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Function Interceptor</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Function Interceptor</h1></header>
<p><a href="https://github.com/facebook/hyperion/blob/main/packages/hyperion-core/src/FunctionInterceptor.ts" target="_blank" rel="noopener noreferrer"><code>FunctionInterceptor&lt;FuncType&gt;</code></a> is at the heart of <a href="/docs/packages/hyperion-core/intro">hyperion-core</a> and creates
a high performance wrapper around a given function and provides following important functionality:</p>
<ul>
<li>observers that can observe function arguments or function return value</li>
<li>mappers that allow callbacks to modify arguments of the function before it is called, or return value of the function after it is called.</li>
<li>mechanism to prevent execution of the function</li>
</ul>
<p>The type argument of the <code>FunctionInterceptor&lt;FuncType&gt;</code> determines the signature of the
function that is intercepted. The signature of callbacks for the following api is computed
based on this given type argument and hence all api provide a fully typed experience.</p>
<p>The following are main API of this class:</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="argument-observers-and-mappers">argument observers and mappers<a href="#argument-observers-and-mappers" class="hash-link" aria-label="Direct link to argument observers and mappers" title="Direct link to argument observers and mappers">​</a></h2>
<p>The <code>onBeforeCallObserverAdd(callback)</code> method allows installing argument observer.
The callback will be called before the original function is called. This callback
can observe the value of the arguments, but cannot change them. The signature of this callback
will be exactly the same as the original function, but it can return a <code>boolean</code> value.
If any such callback returns <code>true</code>, then the original function won&#x27;t be called; which is useful to implement security features or provide alternative implementations for the function.</p>
<p>The <code>onBeforeCallMapperAdd(callback)</code> method allows installing an argument mapper.
The callback will be called before the original function is called. This callback
recieves an array (similar to JavaScript <code>arguments</code> object) and can modify and return
a new argument array with new values of the arguments.
This callback is more expensive than the observer variant and should be used with care.</p>
<p>If multiple mappers are installed, the output of each callback is passed to the next one as input.</p>
<p>See <a href="https://github.com/facebook/hyperion/blob/main/packages/hyperion-core/test/FunctionInterceptor.test.ts" target="_blank" rel="noopener noreferrer">FunctionInterceptor.test.ts</a> for example code.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="return-value-observers-and-mappers">return value observers and mappers<a href="#return-value-observers-and-mappers" class="hash-link" aria-label="Direct link to return value observers and mappers" title="Direct link to return value observers and mappers">​</a></h2>
<p>The <code>onAfterCallObserverAdd(callback)</code> method allows installing return value observer.
The callback recieves a value of the type of the original function return value and return void. This function is called original function is called.</p>
<p>The <code>onAfterCallMapperAdd(callback)</code> also allows the callback to change the return value of the function to something of <strong>the same type</strong>.</p>
<p>If multiple mappers are installed, the output of each callback is passed to the next one as input.</p>
<p>See <a href="https://github.com/facebook/hyperion/blob/main/packages/hyperion-core/test/FunctionInterceptor.test.ts" target="_blank" rel="noopener noreferrer">FunctionInterceptor.test.ts</a> for example code.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="argument--return-value-mapper">argument + return value mapper<a href="#argument--return-value-mapper" class="hash-link" aria-label="Direct link to argument + return value mapper" title="Direct link to argument + return value mapper">​</a></h2>
<p>Sometimes we might need to know the input arguments to make a modification to the return value.
Or we might need to create intermediary values based on input argument before the function call
and then use that value after the function call to process the output.
We might even simply want to run to pieces of related code before and after a function (e.g. start time and end time of a function to measure its latency)</p>
<p>To make such cases easier, the <code>onBeforeAndAfterCallMapperAdd(callback)</code> method allows
a callback to receive arguments of the function in an array (which it can update) and return
a function that will be used to observe or map the return value of the function.</p>
<p>Note that this function is the most expensive form of interception and should be used only
when really necessary.</p>
<p>See <a href="https://github.com/facebook/hyperion/blob/main/packages/hyperion-core/test/FunctionInterceptor.test.ts" target="_blank" rel="noopener noreferrer">FunctionInterceptor.test.ts</a> for example code.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="extra-data-on-the-interceptor-object">extra data on the interceptor object<a href="#extra-data-on-the-interceptor-object" class="hash-link" aria-label="Direct link to extra data on the interceptor object" title="Direct link to extra data on the interceptor object">​</a></h2>
<p>The <code>FunctionInterceptor</code> class creates an interceptor object which can also carry
extra data. the <code>setData&lt;T&gt;(dataPropName: string, value: T): void</code> and <code>getData&lt;T&gt;(dataPropName: string): T | undefined</code> methods allow named properties to be added to this object.</p>
<p>A very common usecase to track if certain type of callback is added to an interceptor. While one can implement such functionality using combination of <code>getData</code> and <code>setData</code>, the helper <code>testAndSet(dataPropName: string): boolean</code> method provide this functionality out of the box.</p>
<p>All of the above methods have a corresponding <code>...Remove</code> counterpart that allow removing
a callback at any time. This is particularly useful at runtime if an observer has found the
situation it was looking for and can remove the callback to reduce the performace overhead it adds.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="builtin-js-interceptors">Builtin JS interceptors<a href="#builtin-js-interceptors" class="hash-link" aria-label="Direct link to Builtin JS interceptors" title="Direct link to Builtin JS interceptors">​</a></h2>
<p>The <code>hyperion-core</code> package already contains ready main interceptors for the following JS objects</p>
<ul>
<li>IGlobalThis provides interceptors for global methods such as (setTimeout, setInterval)</li>
<li>IPromise provies interceptos for all <code>Promise</code> methods and constructors</li>
<li>IRequre provide interceptors for typical implementations of js <code>require</code> funcationality which can be used to investigate modules and bootstrap further interception of their output.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebookincubator/hyperion/tree/gh-pages/docs/packages/hyperion-core/FunctionInterceptor.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_g62E"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/packages/hyperion-core/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">intro</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/packages/hyperion-core/BuiltInInterceptors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Builtin JS interceptors</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#argument-observers-and-mappers" class="table-of-contents__link toc-highlight">argument observers and mappers</a></li><li><a href="#return-value-observers-and-mappers" class="table-of-contents__link toc-highlight">return value observers and mappers</a></li><li><a href="#argument--return-value-mapper" class="table-of-contents__link toc-highlight">argument + return value mapper</a></li><li><a href="#extra-data-on-the-interceptor-object" class="table-of-contents__link toc-highlight">extra data on the interceptor object</a></li><li><a href="#builtin-js-interceptors" class="table-of-contents__link toc-highlight">Builtin JS interceptors</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Meta Platforms, Inc. and affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>